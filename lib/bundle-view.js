"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const atom_space_pen_views_1 = require("atom-space-pen-views");
class BundleView extends atom_space_pen_views_1.SelectListView {
    initialize() {
        return super.initialize(...arguments);
    }
    viewForItem({ name, action }) {
        return atom_space_pen_views_1.$$(function () {
            return this.li(() => {
                return this.div({ class: `status-${action} icon icon-diff-${action}` }, name);
            });
        });
    }
    confirmed() {
        if (this.isDisabled()) {
            return this.setNeutral();
        }
        else if (this.isNeutral()) {
            return this.setEnabled();
        }
        else {
            return this.setDisabled();
        }
    }
    cancel() {
        const items = [];
        this.items.forEach(function (item) {
            if (item.action !== "ignored") {
                return items.push(item);
            }
        });
        super.cancel(...arguments);
        if (this.panel != null) {
            this.panel.hide();
        }
        if (items.length !== 0) {
            return this.cb(this.oldname, items);
        }
    }
    show(bundle = null, cb) {
        let actions;
        this.cb = cb;
        if (this.panel == null) {
            this.panel = atom.workspace.addModalPanel({ item: this });
        }
        this.panel.show();
        if (bundle != null) {
            this.oldname = bundle.name;
            actions = bundle.packages;
        }
        else {
            this.oldname = null;
            actions = [];
        }
        const packages = [];
        atom.packages.getAvailablePackageNames().forEach(function (name) {
            let action = actions.filter((item) => item.name === name);
            action = action[0] != null ? action[0].action : undefined;
            if (action == null) {
                action = "ignored";
            }
            return packages.push({ name, action });
        });
        this.setItems(packages);
        return this.focusFilterEditor();
    }
    populateList(view = null) {
        if (!view) {
            return super.populateList(...arguments);
        }
        const new_view = atom_space_pen_views_1.$(this.viewForItem(view.data("select-list-item")));
        new_view.data("select-list-item", view.data("select-list-item"));
        for (let index = 0; index < this.items.length; index++) {
            const item = this.items[index];
            if (item.name === view.data("select-list-item").name) {
                this.items[index].action = view.data("select-list-item").action;
                break;
            }
        }
        view.replaceWith(new_view);
        return this.selectItemView(new_view);
    }
    getFilterKey() {
        return "name";
    }
    isDisabled() {
        return this.getSelectedItemView().data("select-list-item").action === "removed";
    }
    isNeutral() {
        return this.getSelectedItemView().data("select-list-item").action === "ignored";
    }
    isEnabled() {
        return this.getSelectedItemView().data("select-list-item").action === "added";
    }
    setNeutral() {
        const view = this.getSelectedItemView();
        const data = view.data("select-list-item");
        data.action = "ignored";
        return this.populateList(view);
    }
    setEnabled() {
        const view = this.getSelectedItemView();
        const data = view.data("select-list-item");
        data.action = "added";
        return this.populateList(view);
    }
    setDisabled() {
        const view = this.getSelectedItemView();
        const data = view.data("select-list-item");
        data.action = "removed";
        return this.populateList(view);
    }
}
exports.BundleView = BundleView;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLXZpZXcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvYnVuZGxlLXZpZXcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFNQSwrREFBNEQ7QUFFNUQsTUFBYSxVQUFXLFNBQVEscUNBQWM7SUFDNUMsVUFBVTtRQUNSLE9BQU8sS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxDQUFBO0lBQ3ZDLENBQUM7SUFFRCxXQUFXLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFO1FBQzFCLE9BQU8seUJBQUUsQ0FBQztZQUNSLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUU7Z0JBQ2xCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRSxVQUFVLE1BQU0sbUJBQW1CLE1BQU0sRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUE7WUFDL0UsQ0FBQyxDQUFDLENBQUE7UUFDSixDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxTQUFTO1FBQ1AsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFDckIsT0FBTyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7U0FDekI7YUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsRUFBRTtZQUMzQixPQUFPLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtTQUN6QjthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7U0FDMUI7SUFDSCxDQUFDO0lBRUQsTUFBTTtRQUNKLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQTtRQUNoQixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLElBQUk7WUFDL0IsSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLFNBQVMsRUFBRTtnQkFDN0IsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO2FBQ3hCO1FBQ0gsQ0FBQyxDQUFDLENBQUE7UUFDRixLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUE7UUFDMUIsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksRUFBRTtZQUN0QixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFBO1NBQ2xCO1FBQ0QsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN0QixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQTtTQUNwQztJQUNILENBQUM7SUFFRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksRUFBRSxFQUFFO1FBQ3BCLElBQUksT0FBTyxDQUFBO1FBQ1gsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUE7UUFDWixJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQTtTQUMxRDtRQUNELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUE7UUFFakIsSUFBSSxNQUFNLElBQUksSUFBSSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQTtZQUMxQixPQUFPLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQTtTQUMxQjthQUFNO1lBQ0wsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUE7WUFDbkIsT0FBTyxHQUFHLEVBQUUsQ0FBQTtTQUNiO1FBRUQsTUFBTSxRQUFRLEdBQUcsRUFBRSxDQUFBO1FBQ25CLElBQUksQ0FBQyxRQUFRLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxPQUFPLENBQUMsVUFBVSxJQUFJO1lBQzdELElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLENBQUE7WUFDekQsTUFBTSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQTtZQUN6RCxJQUFJLE1BQU0sSUFBSSxJQUFJLEVBQUU7Z0JBQ2xCLE1BQU0sR0FBRyxTQUFTLENBQUE7YUFDbkI7WUFDRCxPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQTtRQUN4QyxDQUFDLENBQUMsQ0FBQTtRQUVGLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDdkIsT0FBTyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQTtJQUNqQyxDQUFDO0lBRUQsWUFBWSxDQUFDLElBQUksR0FBRyxJQUFJO1FBQ3RCLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDVCxPQUFPLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQTtTQUN4QztRQUNELE1BQU0sUUFBUSxHQUFHLHdCQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ25FLFFBQVEsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUE7UUFDaEUsS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQ3RELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUE7WUFDOUIsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxJQUFJLEVBQUU7Z0JBQ3BELElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxNQUFNLENBQUE7Z0JBQy9ELE1BQUs7YUFDTjtTQUNGO1FBQ0QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUMxQixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDdEMsQ0FBQztJQUVELFlBQVk7UUFDVixPQUFPLE1BQU0sQ0FBQTtJQUNmLENBQUM7SUFFRCxVQUFVO1FBQ1IsT0FBTyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxNQUFNLEtBQUssU0FBUyxDQUFBO0lBQ2pGLENBQUM7SUFFRCxTQUFTO1FBQ1AsT0FBTyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxNQUFNLEtBQUssU0FBUyxDQUFBO0lBQ2pGLENBQUM7SUFFRCxTQUFTO1FBQ1AsT0FBTyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxNQUFNLEtBQUssT0FBTyxDQUFBO0lBQy9FLENBQUM7SUFFRCxVQUFVO1FBQ1IsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUE7UUFDdkMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO1FBQzFDLElBQUksQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFBO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNoQyxDQUFDO0lBRUQsVUFBVTtRQUNSLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFBO1FBQ3ZDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQTtRQUMxQyxJQUFJLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQTtRQUNyQixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDaEMsQ0FBQztJQUVELFdBQVc7UUFDVCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQTtRQUN2QyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUE7UUFDMUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUE7UUFDdkIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ2hDLENBQUM7Q0FDRjtBQTFIRCxnQ0EwSEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBkZWNhZmZlaW5hdGUgc3VnZ2VzdGlvbnM6XHJcbiAqIERTMTAyOiBSZW1vdmUgdW5uZWNlc3NhcnkgY29kZSBjcmVhdGVkIGJlY2F1c2Ugb2YgaW1wbGljaXQgcmV0dXJuc1xyXG4gKiBEUzIwNzogQ29uc2lkZXIgc2hvcnRlciB2YXJpYXRpb25zIG9mIG51bGwgY2hlY2tzXHJcbiAqIEZ1bGwgZG9jczogaHR0cHM6Ly9naXRodWIuY29tL2RlY2FmZmVpbmF0ZS9kZWNhZmZlaW5hdGUvYmxvYi9tYXN0ZXIvZG9jcy9zdWdnZXN0aW9ucy5tZFxyXG4gKi9cclxuaW1wb3J0IHsgJCwgJCQsIFNlbGVjdExpc3RWaWV3IH0gZnJvbSBcImF0b20tc3BhY2UtcGVuLXZpZXdzXCJcclxuXHJcbmV4cG9ydCBjbGFzcyBCdW5kbGVWaWV3IGV4dGVuZHMgU2VsZWN0TGlzdFZpZXcge1xyXG4gIGluaXRpYWxpemUoKSB7XHJcbiAgICByZXR1cm4gc3VwZXIuaW5pdGlhbGl6ZSguLi5hcmd1bWVudHMpXHJcbiAgfVxyXG5cclxuICB2aWV3Rm9ySXRlbSh7IG5hbWUsIGFjdGlvbiB9KSB7XHJcbiAgICByZXR1cm4gJCQoZnVuY3Rpb24gKCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5saSgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGl2KHsgY2xhc3M6IGBzdGF0dXMtJHthY3Rpb259IGljb24gaWNvbi1kaWZmLSR7YWN0aW9ufWAgfSwgbmFtZSlcclxuICAgICAgfSlcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBjb25maXJtZWQoKSB7XHJcbiAgICBpZiAodGhpcy5pc0Rpc2FibGVkKCkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuc2V0TmV1dHJhbCgpXHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNOZXV0cmFsKCkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuc2V0RW5hYmxlZCgpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5zZXREaXNhYmxlZCgpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjYW5jZWwoKSB7XHJcbiAgICBjb25zdCBpdGVtcyA9IFtdXHJcbiAgICB0aGlzLml0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgaWYgKGl0ZW0uYWN0aW9uICE9PSBcImlnbm9yZWRcIikge1xyXG4gICAgICAgIHJldHVybiBpdGVtcy5wdXNoKGl0ZW0pXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgICBzdXBlci5jYW5jZWwoLi4uYXJndW1lbnRzKVxyXG4gICAgaWYgKHRoaXMucGFuZWwgIT0gbnVsbCkge1xyXG4gICAgICB0aGlzLnBhbmVsLmhpZGUoKVxyXG4gICAgfVxyXG4gICAgaWYgKGl0ZW1zLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5jYih0aGlzLm9sZG5hbWUsIGl0ZW1zKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2hvdyhidW5kbGUgPSBudWxsLCBjYikge1xyXG4gICAgbGV0IGFjdGlvbnNcclxuICAgIHRoaXMuY2IgPSBjYlxyXG4gICAgaWYgKHRoaXMucGFuZWwgPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLnBhbmVsID0gYXRvbS53b3Jrc3BhY2UuYWRkTW9kYWxQYW5lbCh7IGl0ZW06IHRoaXMgfSlcclxuICAgIH1cclxuICAgIHRoaXMucGFuZWwuc2hvdygpXHJcblxyXG4gICAgaWYgKGJ1bmRsZSAhPSBudWxsKSB7XHJcbiAgICAgIHRoaXMub2xkbmFtZSA9IGJ1bmRsZS5uYW1lXHJcbiAgICAgIGFjdGlvbnMgPSBidW5kbGUucGFja2FnZXNcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMub2xkbmFtZSA9IG51bGxcclxuICAgICAgYWN0aW9ucyA9IFtdXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGFja2FnZXMgPSBbXVxyXG4gICAgYXRvbS5wYWNrYWdlcy5nZXRBdmFpbGFibGVQYWNrYWdlTmFtZXMoKS5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgIGxldCBhY3Rpb24gPSBhY3Rpb25zLmZpbHRlcigoaXRlbSkgPT4gaXRlbS5uYW1lID09PSBuYW1lKVxyXG4gICAgICBhY3Rpb24gPSBhY3Rpb25bMF0gIT0gbnVsbCA/IGFjdGlvblswXS5hY3Rpb24gOiB1bmRlZmluZWRcclxuICAgICAgaWYgKGFjdGlvbiA9PSBudWxsKSB7XHJcbiAgICAgICAgYWN0aW9uID0gXCJpZ25vcmVkXCJcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcGFja2FnZXMucHVzaCh7IG5hbWUsIGFjdGlvbiB9KVxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLnNldEl0ZW1zKHBhY2thZ2VzKVxyXG4gICAgcmV0dXJuIHRoaXMuZm9jdXNGaWx0ZXJFZGl0b3IoKVxyXG4gIH1cclxuXHJcbiAgcG9wdWxhdGVMaXN0KHZpZXcgPSBudWxsKSB7XHJcbiAgICBpZiAoIXZpZXcpIHtcclxuICAgICAgcmV0dXJuIHN1cGVyLnBvcHVsYXRlTGlzdCguLi5hcmd1bWVudHMpXHJcbiAgICB9XHJcbiAgICBjb25zdCBuZXdfdmlldyA9ICQodGhpcy52aWV3Rm9ySXRlbSh2aWV3LmRhdGEoXCJzZWxlY3QtbGlzdC1pdGVtXCIpKSlcclxuICAgIG5ld192aWV3LmRhdGEoXCJzZWxlY3QtbGlzdC1pdGVtXCIsIHZpZXcuZGF0YShcInNlbGVjdC1saXN0LWl0ZW1cIikpXHJcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5pdGVtcy5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgY29uc3QgaXRlbSA9IHRoaXMuaXRlbXNbaW5kZXhdXHJcbiAgICAgIGlmIChpdGVtLm5hbWUgPT09IHZpZXcuZGF0YShcInNlbGVjdC1saXN0LWl0ZW1cIikubmFtZSkge1xyXG4gICAgICAgIHRoaXMuaXRlbXNbaW5kZXhdLmFjdGlvbiA9IHZpZXcuZGF0YShcInNlbGVjdC1saXN0LWl0ZW1cIikuYWN0aW9uXHJcbiAgICAgICAgYnJlYWtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdmlldy5yZXBsYWNlV2l0aChuZXdfdmlldylcclxuICAgIHJldHVybiB0aGlzLnNlbGVjdEl0ZW1WaWV3KG5ld192aWV3KVxyXG4gIH1cclxuXHJcbiAgZ2V0RmlsdGVyS2V5KCkge1xyXG4gICAgcmV0dXJuIFwibmFtZVwiXHJcbiAgfVxyXG5cclxuICBpc0Rpc2FibGVkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0U2VsZWN0ZWRJdGVtVmlldygpLmRhdGEoXCJzZWxlY3QtbGlzdC1pdGVtXCIpLmFjdGlvbiA9PT0gXCJyZW1vdmVkXCJcclxuICB9XHJcblxyXG4gIGlzTmV1dHJhbCgpIHtcclxuICAgIHJldHVybiB0aGlzLmdldFNlbGVjdGVkSXRlbVZpZXcoKS5kYXRhKFwic2VsZWN0LWxpc3QtaXRlbVwiKS5hY3Rpb24gPT09IFwiaWdub3JlZFwiXHJcbiAgfVxyXG5cclxuICBpc0VuYWJsZWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRTZWxlY3RlZEl0ZW1WaWV3KCkuZGF0YShcInNlbGVjdC1saXN0LWl0ZW1cIikuYWN0aW9uID09PSBcImFkZGVkXCJcclxuICB9XHJcblxyXG4gIHNldE5ldXRyYWwoKSB7XHJcbiAgICBjb25zdCB2aWV3ID0gdGhpcy5nZXRTZWxlY3RlZEl0ZW1WaWV3KClcclxuICAgIGNvbnN0IGRhdGEgPSB2aWV3LmRhdGEoXCJzZWxlY3QtbGlzdC1pdGVtXCIpXHJcbiAgICBkYXRhLmFjdGlvbiA9IFwiaWdub3JlZFwiXHJcbiAgICByZXR1cm4gdGhpcy5wb3B1bGF0ZUxpc3QodmlldylcclxuICB9XHJcblxyXG4gIHNldEVuYWJsZWQoKSB7XHJcbiAgICBjb25zdCB2aWV3ID0gdGhpcy5nZXRTZWxlY3RlZEl0ZW1WaWV3KClcclxuICAgIGNvbnN0IGRhdGEgPSB2aWV3LmRhdGEoXCJzZWxlY3QtbGlzdC1pdGVtXCIpXHJcbiAgICBkYXRhLmFjdGlvbiA9IFwiYWRkZWRcIlxyXG4gICAgcmV0dXJuIHRoaXMucG9wdWxhdGVMaXN0KHZpZXcpXHJcbiAgfVxyXG5cclxuICBzZXREaXNhYmxlZCgpIHtcclxuICAgIGNvbnN0IHZpZXcgPSB0aGlzLmdldFNlbGVjdGVkSXRlbVZpZXcoKVxyXG4gICAgY29uc3QgZGF0YSA9IHZpZXcuZGF0YShcInNlbGVjdC1saXN0LWl0ZW1cIilcclxuICAgIGRhdGEuYWN0aW9uID0gXCJyZW1vdmVkXCJcclxuICAgIHJldHVybiB0aGlzLnBvcHVsYXRlTGlzdCh2aWV3KVxyXG4gIH1cclxufVxyXG4iXX0=