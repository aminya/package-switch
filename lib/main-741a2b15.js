"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var a=require("atom"),t=e(require("fs")),n=e(require("path")),i=function(e,a){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,a){e.__proto__=a}||function(e,a){for(var t in a)a.hasOwnProperty(t)&&(e[t]=a[t])})(e,a)};function c(e,a,t,n){return new(t||(t=Promise))((function(i,c){function o(e){try{r(n.next(e))}catch(e){c(e)}}function s(e){try{r(n.throw(e))}catch(e){c(e)}}function r(e){var a;e.done?i(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(o,s)}r((n=n.apply(e,a||[])).next())}))}function o(e,a){var t,n,i,c,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return c={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function s(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=a.call(e,o)}catch(e){c=[6,e],n=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}var s,r,u,g,l,p,f,h,k=function(){function e(e,a){if(this.name=e,this.filepath=a,t.existsSync(this.filepath))try{this.packages=JSON.parse(t.readFileSync(this.filepath)),null==this.packages&&(this.packages=[])}catch(e){atom.notifications.addError(e)}else this.packages=[]}return e.prototype.execute=function(e){this.packages.map((function(a){return e?"removed"===a.action?atom.packages.enablePackage(a.name):atom.packages.disablePackage(a.name):"added"===a.action?atom.packages.enablePackage(a.name):atom.packages.disablePackage(a.name)}))},e.prototype.save=function(){try{t.writeFileSync(this.filepath,JSON.stringify(this.packages,null,"\t"))}catch(e){atom.notifications.addError(e)}},e}(),d=function(){function e(e,a){atom.notifications.addWarning("Using CSON config for package-switch is deprecated. \n    Convert "+a+" to JSON at https://decaffeinate-project.org/repl/"),Promise.resolve().then((function(){return require("./cson-13f3b068.js")})).then((function(e){s=e})),this.name=e,this.filepath=a;try{this.packages=s.readFileSync(this.filepath),null==this.packages&&(this.packages=[])}catch(e){this.packages=[]}}return e.prototype.execute=function(e){this.packages.map((function(a){return e?"removed"===a.action?atom.packages.enablePackage(a.name):atom.packages.disablePackage(a.name):"added"===a.action?atom.packages.enablePackage(a.name):atom.packages.disablePackage(a.name)}))},e.prototype.save=function(){try{s.writeFileSync(this.filepath,this.packages)}catch(e){}},e}(),m=null;function v(){return c(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return u?[3,2]:[4,Promise.resolve().then((function(){return require("./lazyloader-db04fd1a.js")}))];case 1:u=e.sent(),p=u.bundlesview,l=u.bundleview,f=u.nameview,r=u.InitFileView,g=u.bundles,e.label=2;case 2:return[2]}}))}))}function w(e){void 0===e&&(e=!1),v().then((function(){p.show(g.getBundles(),(function(a){!function(e,a){v().then((function(){var t;null===(t=g.getBundle(a.name))||void 0===t||t.execute(e)}))}(e,a)}),e)}))}function b(e,a){v().then((function(){f.show(g,e,a,{confirmCallback:function(e,a,t){!function(e,a,t){v().then((function(){null!=e?g.replaceBundle(e,a,t):g.addBundle(a,t)}))}(e,a,t)},backCallback:function(e,a){return y({name:e,packages:a})}})}))}function y(e){void 0===e&&(e=null),v().then((function(){l.show(e,(function(e,a){return b(e,a)}))}))}exports.InitFile=k,exports.InitFileCSON=d,exports.__extends=function(e,a){function t(){this.constructor=e}i(e,a),e.prototype=null===a?Object.create(a):(t.prototype=a.prototype,new t)},exports.activate=function(){!function(){var e=atom.project.getPaths();if(1===e.length){var a=n.join(e[0],".package-switch.json");t.stat(a,(function(t,i){t&&!i&&(atom.packages.activatePackage("tree-view"),atom.packages.activatePackage("tabs"),atom.packages.activatePackage("settings-view"),atom.packages.activatePackage("command-palette")),setTimeout((function(){return new k(n.basename(e[0]),a).execute(!1)}),atom.config.get("package-switch.DeferInitialization"))}));var i=n.join(e[0],".package-switch.cson");t.existsSync(i)&&t.stat(i,(function(a,t){a&&!t&&(atom.packages.activatePackage("tree-view"),atom.packages.activatePackage("tabs"),atom.packages.activatePackage("settings-view"),atom.packages.activatePackage("command-palette")),setTimeout((function(){return new d(n.basename(e[0]),i).execute(!1)}),atom.config.get("package-switch.DeferInitialization"))}))}else atom.packages.activatePackage("tree-view"),atom.packages.activatePackage("tabs"),atom.packages.activatePackage("settings-view"),atom.packages.activatePackage("command-palette")}(),(h=new a.CompositeDisposable).add(atom.commands.add("atom-workspace",{"package-switch:start-packages":function(){return w()},"package-switch:stop-packages":function(){return w(!0)},"package-switch:create":function(){return y()},"package-switch:edit":function(){v().then((function(){p.show(g.getBundles(!1),(function(e){return y(e)}))}))},"package-switch:remove":function(){v().then((function(){p.show(g.getBundles(!1),(function(e){return function(e){v().then((function(){g.removeBundle(e.name)}))}(e)}))}))},"package-switch:open-global":function(){atom.workspace.open(n.join(n.dirname(atom.config.getUserConfigPath()),"package-switch.bundles"))}}),atom.commands.add('.tree-view .file .name[data-name$="\\.package-switch\\.json"]',"package-switch:open-local",(function(e){var a=e.target;return atom.workspace.open(a.dataset.path,{noopener:!0})})),atom.config.onDidChange("package-switch.SaveRestore",(function(e){e.newValue&&atom.config.set("package-switch.SaveData",atom.config.get("core.disabledPackages").filter((function(e,a,t){return t.indexOf(e)===a})))})),atom.workspace.addOpener((function(e,a){null==a.noopener&&v().then((function(){e.endsWith(".package-switch.json")?m=new r({uri:e,file:new k(n.dirname(e),e)}):e.endsWith(".package-switch.cson")&&(m=new r({uri:e,file:new d(n.dirname(e),e)}))}))})))},exports.config={SaveRestore:{title:"Save and restore packages",description:"Restore package states when deactivating this package (e.g. when closing Atom)",type:"boolean",default:!1},SaveData:{title:"Package States",description:"Array of packages to disable when deactivating this package",type:"array",default:[]},DeferInitialization:{title:"Activation Timeout",description:"Number of milliseconds to defer execution of local bundles",type:"integer",default:100},InvertSaveData:{title:"Invert Package States",description:'Disable ALL packages EXCEPT those in "Package States". This includes core packages like tabs, tree-view and settings-view!!!',type:"boolean",default:!1},DisableLanguagePackages:{title:"Do not disable Language Packages",description:'Do not disable language packages. Only if "Invert Package States" is checked',type:"boolean",default:!1}},exports.deactivate=function(){if(atom.config.get("package-switch.SaveRestore")){if(atom.config.get("package-switch.InvertSaveData")){for(var e=atom.config.get("package-switch.DisableLanguagePackages"),a=atom.config.get("package-switch.SaveData"),t=[],n=0,i=atom.packages.getAvailablePackageNames();n<i.length;n++){var c=i[n];"package-switch"!==c&&(a.includes(c)||e&&c.startsWith("language-")||t.push(c))}atom.config.set("core.disabledPackages",t)}else atom.config.set("core.disabledPackages",atom.config.get("package-switch.SaveData"));atom.config.save()}h.dispose(),g&&g.destroy(),f&&f.destroy(),m&&m.destroy()};
//# sourceMappingURL=main-741a2b15.js.map
