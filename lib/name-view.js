"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const space_pen_1 = require("space-pen");
const atom_space_pen_views_1 = require("atom-space-pen-views");
const atom_1 = require("atom");
class NameView extends space_pen_1.View {
    constructor() {
        super();
        this.nameEditor = null;
        this.nameEditor = this.bundle_name.getModel();
        this.disposables = new atom_1.CompositeDisposable();
        this.on("click", ".buttons .icon-x", (event) => this.cancel(event));
        this.on("click", ".buttons .icon-check", (event) => this.accept(event));
        this.on("click", ".buttons .icon-arrow-left", (event) => this.back(event));
        this.disposables.add(atom.commands.add(this.element, {
            "core:confirm": (event) => this.accept(event),
            "core:cancel": (event) => this.cancel(event),
        }));
    }
    static content() {
        this.div({ class: "nameview" }, () => {
            this.div({ class: "block" }, () => {
                this.label(() => {
                    this.div({ class: "bundle-name" }, "Bundle Name");
                });
                this.subview("bundle_name", new atom_space_pen_views_1.TextEditorView({ mini: true }));
                this.div({ id: "name-error-none", class: "error hidden" }, "This field cannot be empty");
                this.div({ id: "name-error-used", class: "error hidden" }, "Name already used");
            });
            this.div({ class: "block text-subtle" }, () => {
                this.div({ class: "added icon icon-diff-added hidden", outlet: "added" });
                this.div({ class: "removed icon icon-diff-removed hidden", outlet: "removed" });
            });
            this.div({ class: "buttons" }, () => {
                this.div(() => {
                    this.div({ class: "btn btn-error icon icon-x inline-block-tight" }, "Cancel");
                    this.div({ class: " btn btn-error icon icon-arrow-left inline-block-tight" }, "Back");
                });
                this.div({ class: "btn btn-primary icon icon-check inline-block-tight" }, "Accept");
            });
        });
    }
    destroy() {
        this.disposables.dispose();
        this.detach();
        this.panel != null ? this.panel.hide() : undefined;
    }
    cancel(event) {
        if (this.panel != null) {
            this.panel.hide();
        }
        event.stopPropagation();
    }
    back(event) {
        this.backCallback(this.oldname, this.items);
        this.cancel(event);
    }
    accept(event) {
        if (!this.validInput()) {
            if (this.nameEditor.getText() === "") {
                this.find("#name-error-none").removeClass("hidden");
            }
            else {
                this.find("#name-error-used").removeClass("hidden");
            }
        }
        else {
            this.cancel(event);
            this.confirmCallback(this.oldname, this.nameEditor.getText(), this.items);
        }
    }
    validInput() {
        this.clearErrors();
        return (this.nameEditor.getText() !== "" &&
            (this.oldname != null || this.bundles.getBundle(this.nameEditor.getText()) == null));
    }
    clearErrors() {
        this.find("#name-error-none").addClass("hidden");
        this.find("#name-error-used").addClass("hidden");
    }
    clearPackages() {
        this.added.addClass("hidden");
        this.removed.addClass("hidden");
    }
    showPackages(div, packages) {
        div.removeClass("hidden");
        div.html(packages.toString());
    }
    show(bundles, oldname, items, { confirmCallback, backCallback }) {
        this.bundles = bundles;
        this.oldname = oldname;
        this.items = items;
        this.confirmCallback = confirmCallback;
        this.backCallback = backCallback;
        if (this.oldname != null) {
            this.nameEditor.setText(this.oldname);
        }
        else {
            this.nameEditor.setText("");
        }
        this.clearErrors();
        this.clearPackages();
        const items_added = [];
        const items_removed = [];
        this.items.forEach(function (item) {
            if (item.action === "added") {
                items_added.push(item.name);
            }
            else {
                items_removed.push(item.name);
            }
        });
        if (items_added.length !== 0) {
            this.showPackages(this.added, items_added);
        }
        if (items_removed.length !== 0) {
            this.showPackages(this.removed, items_removed);
        }
        if (this.panel == null) {
            this.panel = atom.workspace.addModalPanel({ item: this });
        }
        this.panel.show();
        this.bundle_name.focus();
    }
}
exports.NameView = NameView;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmFtZS12aWV3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL25hbWUtdmlldy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUtBLHlDQUFnQztBQUNoQywrREFBcUQ7QUFDckQsK0JBQTBDO0FBRTFDLE1BQWEsUUFBUyxTQUFRLGdCQUFJO0lBMkJoQztRQUNFLEtBQUssRUFBRSxDQUFBO1FBM0JULGVBQVUsR0FBRyxJQUFJLENBQUE7UUE0QmYsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBRTdDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSwwQkFBbUIsRUFBRSxDQUFBO1FBRTVDLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLGtCQUFrQixFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7UUFDbkUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtRQUN2RSxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1FBRTFFLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQzlCLGNBQWMsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDN0MsYUFBYSxFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUss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QzlCO1FBQ0gsQ0FBQyxDQUFDLENBQUE7UUFDRixJQUFJLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQzVCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxXQUFXLENBQUMsQ0FBQTtTQUMzQztRQUNELElBQUksYUFBYSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDOUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLGFBQWEsQ0FBQyxDQUFBO1NBQy9DO1FBRUQsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksRUFBRTtZQUN0QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7U0FDMUQ7UUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFBO1FBQ2pCLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLENBQUE7SUFDMUIsQ0FBQztDQUNGO0FBdElELDRCQXNJQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBkZWNhZmZlaW5hdGUgc3VnZ2VzdGlvbnM6XG4gKiBEUzIwNzogQ29uc2lkZXIgc2hvcnRlciB2YXJpYXRpb25zIG9mIG51bGwgY2hlY2tzXG4gKiBGdWxsIGRvY3M6IGh0dHBzOi8vZ2l0aHViLmNvbS9kZWNhZmZlaW5hdGUvZGVjYWZmZWluYXRlL2Jsb2IvbWFzdGVyL2RvY3Mvc3VnZ2VzdGlvbnMubWRcbiAqL1xuaW1wb3J0IHsgVmlldyB9IGZyb20gXCJzcGFjZS1wZW5cIlxuaW1wb3J0IHsgVGV4dEVkaXRvclZpZXcgfSBmcm9tIFwiYXRvbS1zcGFjZS1wZW4tdmlld3NcIlxuaW1wb3J0IHsgQ29tcG9zaXRlRGlzcG9zYWJsZSB9IGZyb20gXCJhdG9tXCJcblxuZXhwb3J0IGNsYXNzIE5hbWVWaWV3IGV4dGVuZHMgVmlldyB7XG4gIG5hbWVFZGl0b3IgPSBudWxsXG5cbiAgc3RhdGljIGNvbnRlbnQoKSB7XG4gICAgdGhpcy5kaXYoeyBjbGFzczogXCJuYW1ldmlld1wiIH0sICgpID0+IHtcbiAgICAgIHRoaXMuZGl2KHsgY2xhc3M6IFwiYmxvY2tcIiB9LCAoKSA9PiB7XG4gICAgICAgIHRoaXMubGFiZWwoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZGl2KHsgY2xhc3M6IFwiYnVuZGxlLW5hbWVcIiB9LCBcIkJ1bmRsZSBOYW1lXCIpXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc3VidmlldyhcImJ1bmRsZV9uYW1lXCIsIG5ldyBUZXh0RWRpdG9yVmlldyh7IG1pbmk6IHRydWUgfSkpXG4gICAgICAgIHRoaXMuZGl2KHsgaWQ6IFwibmFtZS1lcnJvci1ub25lXCIsIGNsYXNzOiBcImVycm9yIGhpZGRlblwiIH0sIFwiVGhpcyBmaWVsZCBjYW5ub3QgYmUgZW1wdHlcIilcbiAgICAgICAgdGhpcy5kaXYoeyBpZDogXCJuYW1lLWVycm9yLXVzZWRcIiwgY2xhc3M6IFwiZXJyb3IgaGlkZGVuXCIgfSwgXCJOYW1lIGFscmVhZHkgdXNlZFwiKVxuICAgICAgfSlcbiAgICAgIHRoaXMuZGl2KHsgY2xhc3M6IFwiYmxvY2sgdGV4dC1zdWJ0bGVcIiB9LCAoKSA9PiB7XG4gICAgICAgIHRoaXMuZGl2KHsgY2xhc3M6IFwiYWRkZWQgaWNvbiBpY29uLWRpZmYtYWRkZWQgaGlkZGVuXCIsIG91dGxldDogXCJhZGRlZFwiIH0pXG4gICAgICAgIHRoaXMuZGl2KHsgY2xhc3M6IFwicmVtb3ZlZCBpY29uIGljb24tZGlmZi1yZW1vdmVkIGhpZGRlblwiLCBvdXRsZXQ6IFwicmVtb3ZlZFwiIH0pXG4gICAgICB9KVxuICAgICAgdGhpcy5kaXYoeyBjbGFzczogXCJidXR0b25zXCIgfSwgKCkgPT4ge1xuICAgICAgICB0aGlzLmRpdigoKSA9PiB7XG4gICAgICAgICAgdGhpcy5kaXYoeyBjbGFzczogXCJidG4gYnRuLWVycm9yIGljb24gaWNvbi14IGlubGluZS1ibG9jay10aWdodFwiIH0sIFwiQ2FuY2VsXCIpXG4gICAgICAgICAgdGhpcy5kaXYoeyBjbGFzczogXCIgYnRuIGJ0bi1lcnJvciBpY29uIGljb24tYXJyb3ctbGVmdCBpbmxpbmUtYmxvY2stdGlnaHRcIiB9LCBcIkJhY2tcIilcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5kaXYoeyBjbGFzczogXCJidG4gYnRuLXByaW1hcnkgaWNvbiBpY29uLWNoZWNrIGlubGluZS1ibG9jay10aWdodFwiIH0sIFwiQWNjZXB0XCIpXG4gICAgICB9KVxuICAgIH0pXG4gIH1cblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpXG4gICAgdGhpcy5uYW1lRWRpdG9yID0gdGhpcy5idW5kbGVfbmFtZS5nZXRNb2RlbCgpXG5cbiAgICB0aGlzLmRpc3Bvc2FibGVzID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKVxuXG4gICAgdGhpcy5vbihcImNsaWNrXCIsIFwiLmJ1dHRvbnMgLmljb24teFwiLCAoZXZlbnQpID0+IHRoaXMuY2FuY2VsKGV2ZW50KSlcbiAgICB0aGlzLm9uKFwiY2xpY2tcIiwgXCIuYnV0dG9ucyAuaWNvbi1jaGVja1wiLCAoZXZlbnQpID0+IHRoaXMuYWNjZXB0KGV2ZW50KSlcbiAgICB0aGlzLm9uKFwiY2xpY2tcIiwgXCIuYnV0dG9ucyAuaWNvbi1hcnJvdy1sZWZ0XCIsIChldmVudCkgPT4gdGhpcy5iYWNrKGV2ZW50KSlcblxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKFxuICAgICAgYXRvbS5jb21tYW5kcy5hZGQodGhpcy5lbGVtZW50LCB7XG4gICAgICAgIFwiY29yZTpjb25maXJtXCI6IChldmVudCkgPT4gdGhpcy5hY2NlcHQoZXZlbnQpLFxuICAgICAgICBcImNvcmU6Y2FuY2VsXCI6IChldmVudCkgPT4gdGhpcy5jYW5jZWwoZXZlbnQpLFxuICAgICAgfSlcbiAgICApXG4gIH1cblxuICBkZXN0cm95KCkge1xuICAgIHRoaXMuZGlzcG9zYWJsZXMuZGlzcG9zZSgpXG4gICAgdGhpcy5kZXRhY2goKVxuICAgIHRoaXMucGFuZWwgIT0gbnVsbCA/IHRoaXMucGFuZWwuaGlkZSgpIDogdW5kZWZpbmVkXG4gIH1cblxuICBjYW5jZWwoZXZlbnQ/KSB7XG4gICAgaWYgKHRoaXMucGFuZWwgIT0gbnVsbCkge1xuICAgICAgdGhpcy5wYW5lbC5oaWRlKClcbiAgICB9XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcbiAgfVxuXG4gIGJhY2soZXZlbnQ/KSB7XG4gICAgdGhpcy5iYWNrQ2FsbGJhY2sodGhpcy5vbGRuYW1lLCB0aGlzLml0ZW1zKVxuICAgIHRoaXMuY2FuY2VsKGV2ZW50KVxuICB9XG5cbiAgYWNjZXB0KGV2ZW50Pykge1xuICAgIGlmICghdGhpcy52YWxpZElucHV0KCkpIHtcbiAgICAgIGlmICh0aGlzLm5hbWVFZGl0b3IuZ2V0VGV4dCgpID09PSBcIlwiKSB7XG4gICAgICAgIHRoaXMuZmluZChcIiNuYW1lLWVycm9yLW5vbmVcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZmluZChcIiNuYW1lLWVycm9yLXVzZWRcIikucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIilcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jYW5jZWwoZXZlbnQpXG4gICAgICB0aGlzLmNvbmZpcm1DYWxsYmFjayh0aGlzLm9sZG5hbWUsIHRoaXMubmFtZUVkaXRvci5nZXRUZXh0KCksIHRoaXMuaXRlbXMpXG4gICAgfVxuICB9XG5cbiAgdmFsaWRJbnB1dCgpIHtcbiAgICB0aGlzLmNsZWFyRXJyb3JzKClcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5uYW1lRWRpdG9yLmdldFRleHQoKSAhPT0gXCJcIiAmJlxuICAgICAgKHRoaXMub2xkbmFtZSAhPSBudWxsIHx8IHRoaXMuYnVuZGxlcy5nZXRCdW5kbGUodGhpcy5uYW1lRWRpdG9yLmdldFRleHQoKSkgPT0gbnVsbClcbiAgICApXG4gIH1cblxuICBjbGVhckVycm9ycygpIHtcbiAgICB0aGlzLmZpbmQoXCIjbmFtZS1lcnJvci1ub25lXCIpLmFkZENsYXNzKFwiaGlkZGVuXCIpXG4gICAgdGhpcy5maW5kKFwiI25hbWUtZXJyb3ItdXNlZFwiKS5hZGRDbGFzcyhcImhpZGRlblwiKVxuICB9XG5cbiAgY2xlYXJQYWNrYWdlcygpIHtcbiAgICB0aGlzLmFkZGVkLmFkZENsYXNzKFwiaGlkZGVuXCIpXG4gICAgdGhpcy5yZW1vdmVkLmFkZENsYXNzKFwiaGlkZGVuXCIpXG4gIH1cblxuICBzaG93UGFja2FnZXMoZGl2LCBwYWNrYWdlcykge1xuICAgIGRpdi5yZW1vdmVDbGFzcyhcImhpZGRlblwiKVxuICAgIGRpdi5odG1sKHBhY2thZ2VzLnRvU3RyaW5nKCkpXG4gIH1cblxuICBzaG93KGJ1bmRsZXMsIG9sZG5hbWUsIGl0ZW1zLCB7IGNvbmZpcm1DYWxsYmFjaywgYmFja0NhbGxiYWNrIH0pIHtcbiAgICB0aGlzLmJ1bmRsZXMgPSBidW5kbGVzXG4gICAgdGhpcy5vbGRuYW1lID0gb2xkbmFtZVxuICAgIHRoaXMuaXRlbXMgPSBpdGVtc1xuICAgIHRoaXMuY29uZmlybUNhbGxiYWNrID0gY29uZmlybUNhbGxiYWNrXG4gICAgdGhpcy5iYWNrQ2FsbGJhY2sgPSBiYWNrQ2FsbGJhY2tcbiAgICBpZiAodGhpcy5vbGRuYW1lICE9IG51bGwpIHtcbiAgICAgIHRoaXMubmFtZUVkaXRvci5zZXRUZXh0KHRoaXMub2xkbmFtZSlcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uYW1lRWRpdG9yLnNldFRleHQoXCJcIilcbiAgICB9XG4gICAgdGhpcy5jbGVhckVycm9ycygpXG4gICAgdGhpcy5jbGVhclBhY2thZ2VzKClcbiAgICBjb25zdCBpdGVtc19hZGRlZCA9IFtdXG4gICAgY29uc3QgaXRlbXNfcmVtb3ZlZCA9IFtdXG4gICAgdGhpcy5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpZiAoaXRlbS5hY3Rpb24gPT09IFwiYWRkZWRcIikge1xuICAgICAgICBpdGVtc19hZGRlZC5wdXNoKGl0ZW0ubmFtZSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGl0ZW1zX3JlbW92ZWQucHVzaChpdGVtLm5hbWUpXG4gICAgICB9XG4gICAgfSlcbiAgICBpZiAoaXRlbXNfYWRkZWQubGVuZ3RoICE9PSAwKSB7XG4gICAgICB0aGlzLnNob3dQYWNrYWdlcyh0aGlzLmFkZGVkLCBpdGVtc19hZGRlZClcbiAgICB9XG4gICAgaWYgKGl0ZW1zX3JlbW92ZWQubGVuZ3RoICE9PSAwKSB7XG4gICAgICB0aGlzLnNob3dQYWNrYWdlcyh0aGlzLnJlbW92ZWQsIGl0ZW1zX3JlbW92ZWQpXG4gICAgfVxuXG4gICAgaWYgKHRoaXMucGFuZWwgPT0gbnVsbCkge1xuICAgICAgdGhpcy5wYW5lbCA9IGF0b20ud29ya3NwYWNlLmFkZE1vZGFsUGFuZWwoeyBpdGVtOiB0aGlzIH0pXG4gICAgfVxuICAgIHRoaXMucGFuZWwuc2hvdygpXG4gICAgdGhpcy5idW5kbGVfbmFtZS5mb2N1cygpXG4gIH1cbn1cbiJdfQ==